<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Seguridad Social 2026</title>
    
    <meta name="theme-color" content="#F2F6FC"> <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="icon-512.png">

    <link href="https://fonts.googleapis.com/css2?family=Roboto+Flex:opsz,wght@8..144,300;400;500;600&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0,0" rel="stylesheet" />

    <style>
        /* --- DESIGN TOKENS (Material 3 Expressive - Blue/Teal Theme) --- */
        :root {
            /* Palette simulation */
            --md-sys-color-primary: #0061A4;
            --md-sys-color-on-primary: #FFFFFF;
            --md-sys-color-primary-container: #D1E4FF;
            --md-sys-color-on-primary-container: #001D36;
            
            --md-sys-color-secondary: #535F70;
            --md-sys-color-secondary-container: #D7E3F7;
            --md-sys-color-on-secondary-container: #101C2B;

            --md-sys-color-surface: #F9F9FF;
            --md-sys-color-on-surface: #191C20;
            --md-sys-color-surface-container-low: #F3F3FA;
            --md-sys-color-surface-container: #EDEDF4;
            --md-sys-color-surface-container-high: #E7E8EE;

            --md-sys-color-outline: #73777F;
            --md-sys-color-outline-variant: #C3C7CF;

            /* Shapes (Expressive) */
            --md-sys-shape-corner-extra-large: 28px;
            --md-sys-shape-corner-large: 16px;
            --md-sys-shape-corner-full: 100px;

            /* Typography */
            --font-family: 'Roboto Flex', sans-serif;
        }

        /* --- RESET & BASE --- */
        body {
            margin: 0;
            padding: 0;
            background-color: var(--md-sys-color-surface);
            color: var(--md-sys-color-on-surface);
            font-family: var(--font-family);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            -webkit-tap-highlight-color: transparent;
        }

        /* --- COMPONENT: TOP APP BAR (CenterAligned) --- */
        .top-app-bar {
            height: 64px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 16px;
            background-color: var(--md-sys-color-surface); /* Surface blend */
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .headline-title {
            font-size: 22px;
            font-weight: 400; /* Regular */
            color: var(--md-sys-color-on-surface);
            text-align: center;
            flex-grow: 1;
        }

        /* Avatar / User Action */
        .user-action {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 4px 8px 4px 4px;
            border-radius: var(--md-sys-shape-corner-full);
            transition: background-color 0.2s;
        }
        
        .user-action:active {
            background-color: var(--md-sys-color-secondary-container);
        }

        .avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background-color: var(--md-sys-color-primary-container);
            color: var(--md-sys-color-on-primary-container);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 500;
            font-size: 14px;
        }

        .user-name-label {
            font-size: 14px;
            font-weight: 500;
            color: var(--md-sys-color-on-surface);
            display: none; /* Oculto en móviles muy pequeños */
        }
        @media (min-width: 360px) { .user-name-label { display: block; } }

        /* --- COMPONENT: SCAFFOLD BODY --- */
        .scaffold-content {
            padding: 24px 16px;
            max-width: 480px;
            margin: 0 auto;
            width: 100%;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        /* --- COMPONENT: TEXT FIELD (Filled) --- */
        .text-field-container {
            position: relative;
            background-color: var(--md-sys-color-surface-container-high);
            border-radius: var(--md-sys-shape-corner-large) var(--md-sys-shape-corner-large) 0 0;
            height: 56px;
            display: flex;
            align-items: center;
            border-bottom: 1px solid var(--md-sys-color-outline-variant);
            transition: background-color 0.2s;
        }

        /* Estado activo simula el indicador de Compose */
        .text-field-container::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            width: 0%;
            height: 2px;
            background-color: var(--md-sys-color-primary);
            transition: width 0.3s ease;
            left: 50%;
            transform: translateX(-50%);
        }

        .text-field-container:focus-within::after {
            width: 100%;
        }

        .leading-icon {
            padding-left: 12px;
            color: var(--md-sys-color-on-surface);
            opacity: 0.6;
        }

        .text-field-input {
            flex-grow: 1;
            border: none;
            background: none;
            height: 100%;
            padding: 24px 16px 8px 12px; /* Espacio para label flotante */
            font-family: var(--font-family);
            font-size: 16px;
            color: var(--md-sys-color-on-surface);
            outline: none;
            caret-color: var(--md-sys-color-primary);
        }

        .floating-label {
            position: absolute;
            left: 48px; /* 12px padding + 24px icon + 12px gap */
            top: 50%;
            transform: translateY(-50%);
            color: var(--md-sys-color-secondary);
            font-size: 16px;
            pointer-events: none;
            transition: 0.2s cubic-bezier(0.2, 0, 0, 1);
        }

        /* Animación Label */
        .text-field-input:focus ~ .floating-label,
        .text-field-input:not(:placeholder-shown) ~ .floating-label {
            top: 14px;
            font-size: 12px;
            color: var(--md-sys-color-primary);
        }

        select.text-field-input {
            appearance: none; /* Eliminar flecha nativa */
            padding-top: 24px;
        }

        /* --- COMPONENT: ELEVATED CARD (Resultados) --- */
        .result-card {
            background-color: var(--md-sys-color-surface-container-low);
            border-radius: var(--md-sys-shape-corner-extra-large);
            padding: 24px;
            display: flex;
            flex-direction: column;
            gap: 16px;
            /* Elevación Level 1 */
            box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15), 0px 1px 2px 0px rgba(0, 0, 0, 0.30);
        }

        .card-header {
            font-size: 14px;
            font-weight: 500;
            color: var(--md-sys-color-primary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .row {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .label-text { font-size: 14px; color: var(--md-sys-color-secondary); }
        .value-text { font-size: 16px; color: var(--md-sys-color-on-surface); font-weight: 500; }

        .divider {
            height: 1px;
            background-color: var(--md-sys-color-outline-variant);
            margin: 4px 0;
        }

        .total-value {
            font-size: 24px;
            color: var(--md-sys-color-primary);
            font-weight: 600;
        }

        /* --- COMPONENT: ALERT DIALOG (Compose Style) --- */
        dialog {
            border: none;
            border-radius: 28px;
            background-color: var(--md-sys-color-surface-container-high);
            padding: 24px;
            max-width: 312px;
            width: 100%;
            box-shadow: 0px 4px 8px 3px rgba(0, 0, 0, 0.15);
            color: var(--md-sys-color-on-surface);
        }
        
        dialog::backdrop {
            background-color: rgba(0, 0, 0, 0.32); /* Scrim color */
        }

        .dialog-title {
            font-size: 24px;
            margin: 0 0 16px 0;
            font-weight: 400;
        }
        
        .dialog-body {
            font-size: 14px;
            color: var(--md-sys-color-on-surface-variant);
            margin-bottom: 24px;
            line-height: 20px;
        }

        .dialog-btn {
            float: right;
            background: none;
            border: none;
            color: var(--md-sys-color-primary);
            font-weight: 500;
            padding: 10px 12px;
            border-radius: 20px;
            cursor: pointer;
            font-family: var(--font-family);
        }
        .dialog-btn:hover { background-color: rgba(0, 97, 164, 0.08); }

        /* Utilidad */
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <header class="top-app-bar">
        <div style="width: 48px;"></div> <h1 class="headline-title">Seguridad Social</h1>
        
        <div class="user-action" id="profileTrigger">
            <div class="avatar">JC</div>
            <span class="user-name-label">Jonathan Coral</span>
        </div>
    </header>

    <main class="scaffold-content">

        <div class="text-field-container">
            <span class="material-symbols-rounded leading-icon">attach_money</span>
            <input type="number" id="pago" class="text-field-input" placeholder=" " inputmode="numeric" autofocus>
            <label class="floating-label">Ingreso base mensual</label>
        </div>

        <div class="text-field-container">
            <span class="material-symbols-rounded leading-icon">tune</span>
            <select id="metodo" class="text-field-input">
                <option value="1">Ingresar días manualmente</option>
                <option value="2">Calcular por fechas</option>
            </select>
            <label class="floating-label">Método de cálculo</label>
        </div>

        <div id="group-dias" class="text-field-container">
            <span class="material-symbols-rounded leading-icon">123</span>
            <input type="number" id="dias" class="text-field-input" placeholder=" " inputmode="numeric">
            <label class="floating-label">Días trabajados</label>
        </div>

        <div id="group-fechas" class="hidden" style="display: flex; flex-direction: column; gap: 24px;">
            <div class="text-field-container">
                <span class="material-symbols-rounded leading-icon">date_range</span>
                <input type="date" id="fecha1" class="text-field-input" placeholder=" ">
                <label class="floating-label" style="top: 14px; font-size: 12px; color: var(--md-sys-color-primary);">Fecha inicial</label>
            </div>
            <div class="text-field-container">
                <span class="material-symbols-rounded leading-icon">event</span>
                <input type="date" id="fecha2" class="text-field-input" placeholder=" ">
                <label class="floating-label" style="top: 14px; font-size: 12px; color: var(--md-sys-color-primary);">Fecha final</label>
            </div>
        </div>

        <div class="result-card">
            <span class="card-header">Liquidación Estimada</span>
            
            <div class="row">
                <span class="label-text">IBC Calculado</span>
                <span class="value-text" id="out-ibc">$0</span>
            </div>
            <div class="row">
                <span class="label-text">Días liquidados</span>
                <span class="value-text" id="out-dias">0</span>
            </div>
            
            <div class="divider"></div>

            <div class="row">
                <span class="label-text">Salud (12.5%)</span>
                <span class="value-text" id="out-salud">$0</span>
            </div>
            <div class="row">
                <span class="label-text">Pensión (16.0%)</span>
                <span class="value-text" id="out-pension">$0</span>
            </div>

            <div class="divider"></div>

            <div class="row">
                <span class="label-text" style="font-weight: 500; color: var(--md-sys-color-on-surface);">Total a Pagar</span>
                <span class="total-value" id="out-total">$0</span>
            </div>
        </div>

    </main>

    <dialog id="creditosDialog">
        <h2 class="dialog-title">Acerca de</h2>
        <div class="dialog-body">
            <p><strong>Desarrollado por:</strong><br>Jonathan Coral</p>
            <p style="margin-top: 12px;"><strong>Contacto:</strong><br>jonathancoral@unicomfacauca.edu.co</p>
            <p style="margin-top: 12px; font-size: 12px;">Versión 2.0 (Material 3 Expressive)</p>
        </div>
        <button class="dialog-btn" id="btnClose">Entendido</button>
    </dialog>

    <script>
        // --- Lógica de Negocio (Backend en Frontend) ---
        const SMMLV_2026 = 1750905;

        // Referencias DOM
        const ui = {
            pago: document.getElementById('pago'),
            metodo: document.getElementById('metodo'),
            dias: document.getElementById('dias'),
            fecha1: document.getElementById('fecha1'),
            fecha2: document.getElementById('fecha2'),
            groupDias: document.getElementById('group-dias'),
            groupFechas: document.getElementById('group-fechas'),
            outIbc: document.getElementById('out-ibc'),
            outDias: document.getElementById('out-dias'),
            outSalud: document.getElementById('out-salud'),
            outPension: document.getElementById('out-pension'),
            outTotal: document.getElementById('out-total'),
            dialog: document.getElementById('creditosDialog'),
            profileTrigger: document.getElementById('profileTrigger'),
            btnClose: document.getElementById('btnClose')
        };

        // Utilidad: Formato Moneda COP
        const formatCOP = (num) => new Intl.NumberFormat('es-CO', { 
            style: 'currency', currency: 'COP', maximumFractionDigits: 0 
        }).format(num);

        // Lógica: Calcular
        const calcular = () => {
            const pagoVal = parseFloat(ui.pago.value) || 0;
            const metodoVal = ui.metodo.value;
            let diasCalc = 0;

            // 1. Determinar Días
            if (metodoVal === '1') {
                diasCalc = parseInt(ui.dias.value) || 0;
            } else {
                const f1 = new Date(ui.fecha1.value + 'T00:00:00'); // Fix zona horaria simple
                const f2 = new Date(ui.fecha2.value + 'T00:00:00');
                if (!isNaN(f1) && !isNaN(f2) && f2 >= f1) {
                    const diffTime = Math.abs(f2 - f1);
                    diasCalc = Math.floor(diffTime / (1000 * 60 * 60 * 24)) + 1;
                }
            }

            // Validaciones mínimas visuales
            if (pagoVal <= 0 || diasCalc <= 0) {
                ui.outTotal.innerText = "$0";
                return;
            }

            // 2. Cálculo IBC (Lógica Original Batch)
            let ibc = (pagoVal * 40) / 100;
            if (ibc < SMMLV_2026) ibc = SMMLV_2026;

            // 3. Factores diarios
            // Batch original: (ibc * 125) / (1000 * 30) -> ibc * 0.125 / 30
            const saludDia = (ibc * 0.125) / 30;
            const pensionDia = (ibc * 0.16) / 30;

            // 4. Totales y Redondeo (Batch logic: redondear a la centena superior si hay residuo)
            const redondearCentena = (val) => {
                let entero = Math.floor(val);
                if (entero % 100 !== 0) {
                    entero = (Math.floor(entero / 100) + 1) * 100;
                }
                return entero;
            };

            const totalSalud = redondearCentena(saludDia * diasCalc);
            const totalPension = redondearCentena(pensionDia * diasCalc);
            const granTotal = redondearCentena(totalSalud + totalPension);

            // 5. Render
            ui.outIbc.innerText = formatCOP(ibc);
            ui.outDias.innerText = diasCalc;
            ui.outSalud.innerText = formatCOP(totalSalud);
            ui.outPension.innerText = formatCOP(totalPension);
            ui.outTotal.innerText = formatCOP(granTotal);
        };

        // Event Listeners: Inputs
        ['pago', 'dias', 'fecha1', 'fecha2'].forEach(id => {
            document.getElementById(id).addEventListener('input', calcular);
        });

        // Event Listener: Cambio de Método
        ui.metodo.addEventListener('change', () => {
            if (ui.metodo.value === '1') {
                ui.groupDias.classList.remove('hidden'); // Clases utilitarias CSS
                ui.groupDias.style.display = 'flex';
                ui.groupFechas.classList.add('hidden');
                ui.groupFechas.style.display = 'none';
                setTimeout(() => ui.dias.focus(), 50);
            } else {
                ui.groupDias.classList.add('hidden');
                ui.groupDias.style.display = 'none';
                ui.groupFechas.classList.remove('hidden');
                ui.groupFechas.style.display = 'flex'; // Restaurar flex container
                setTimeout(() => ui.fecha1.focus(), 50);
            }
            calcular();
        });

        // Lógica: Enter Key Navigation (Comportamiento IME Action Next)
        const inputsOrder = ['pago', 'metodo', 'dias', 'fecha1', 'fecha2'];
        inputsOrder.forEach((id, idx) => {
            const el = document.getElementById(id);
            el.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    // Lógica para saltar inputs ocultos
                    let nextIdx = idx + 1;
                    if (id === 'metodo' && ui.metodo.value === '2') nextIdx = 3; // Saltar a fecha1
                    if (id === 'metodo' && ui.metodo.value === '1') nextIdx = 2; // Ir a dias
                    
                    if (inputsOrder[nextIdx]) {
                        document.getElementById(inputsOrder[nextIdx]).focus();
                    } else {
                        el.blur(); // Cerrar teclado al finalizar
                    }
                }
            });
        });

        // Lógica: Diálogo
        ui.profileTrigger.addEventListener('click', () => ui.dialog.showModal());
        ui.btnClose.addEventListener('click', () => ui.dialog.close());
        ui.dialog.addEventListener('click', (e) => { // Backdrop click
            const rect = ui.dialog.getBoundingClientRect();
            if (e.clientX < rect.left || e.clientX > rect.right || 
                e.clientY < rect.top || e.clientY > rect.bottom) {
                ui.dialog.close();
            }
        });

        // Registro Service Worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js');
        }
    </script>
</body>
</html>
