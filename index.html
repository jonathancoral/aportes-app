<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#F9F9FF">
    <title>Calculadora de Aportes</title>
    
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="icon-192.png">
    <link rel="apple-touch-icon" href="apple-touch-icon.png">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Flex:opsz,wght,GRAD@8..144,300..700,-50..150&display=swap" rel="stylesheet">

    <style>
        :root {
            --motion-emphasized: cubic-bezier(0.2, 0.0, 0, 1.0);
            --md-sys-color-primary: #3949AB;
            --md-sys-color-on-primary: #FFFFFF;
            --md-sys-color-primary-container: #DEE0FF;
            --md-sys-color-on-primary-container: #00105C;
            --md-sys-color-surface: #F9F9FF;
            --md-sys-color-on-surface: #1A1B21;
            --md-sys-color-surface-container: #EDEDF4;
            --md-sys-color-surface-container-high: #E2E2E9;
            --md-sys-color-outline: #767680;
            --md-sys-shape-extra-large: 28px;
        }

        /* Ocultar barra de desplazamiento globalmente */
        * {
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none; /* IE/Edge */
        }
        *::-webkit-scrollbar {
            display: none; /* Chrome/Safari/Edge */
        }

        body {
            margin: 0;
            font-family: 'Roboto Flex', sans-serif;
            background-color: var(--md-sys-color-surface);
            color: var(--md-sys-color-on-surface);
            min-height: 100dvh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
        }

        .top-app-bar {
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding-top: env(safe-area-inset-top);
        }

        .top-app-bar h1 {
            font-size: 24px;
            font-weight: 500;
            margin: 0;
        }

        .scaffold-body {
            flex: 1;
            padding: 8px 24px 40px 24px;
            max-width: 500px;
            margin: 0 auto;
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        .md-field-group { display: flex; flex-direction: column; gap: 8px; }
        .md-label-static { font-size: 14px; font-weight: 600; color: var(--md-sys-color-primary); margin-left: 8px; }

        .md-text-field {
            background-color: var(--md-sys-color-surface-container-high);
            border-radius: 20px;
            height: 64px;
            display: flex;
            padding: 0 20px;
            border: 2px solid transparent;
            transition: all 0.2s;
        }
        
        .md-text-field:focus-within {
            border-color: var(--md-sys-color-primary);
            background-color: var(--md-sys-color-surface);
        }

        .md-text-field input {
            width: 100%; border: none; background: transparent; outline: none;
            font-family: inherit; font-size: 18px; color: var(--md-sys-color-on-surface);
        }

        /* Eliminar flechas en inputs numéricos */
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        .segmented-button {
            display: flex; width: 100%; height: 52px;
            border: 1px solid var(--md-sys-color-outline);
            border-radius: var(--md-sys-shape-extra-large);
            overflow: hidden;
        }

        .segment-item {
            flex: 1; display: flex; align-items: center; justify-content: center;
            font-size: 15px; font-weight: 600; cursor: pointer;
            border-right: 1px solid var(--md-sys-color-outline);
        }

        .segment-item:last-child { border-right: none; }
        .segment-item.active { background-color: var(--md-sys-color-primary-container); color: var(--md-sys-color-on-primary-container); }

        .md-card { background-color: var(--md-sys-color-surface-container); border-radius: var(--md-sys-shape-extra-large); padding: 24px; display: flex; flex-direction: column; gap: 16px; }
        .card-row { display: flex; justify-content: space-between; align-items: center; }
        .row-label { font-size: 15px; opacity: 0.7; }
        .row-value { font-size: 17px; font-weight: 600; }

        .total-pill { background-color: var(--md-sys-color-primary-container); color: var(--md-sys-color-on-primary-container); padding: 20px; border-radius: 24px; display: flex; justify-content: space-between; align-items: center; }
        .total-value { font-size: 26px; font-weight: 700; }

        .fluent-footer {
            text-align: center;
            padding: 32px 24px;
            color: var(--md-sys-color-outline);
            font-size: 13px;
            line-height: 1.6;
        }

        .hidden { display: none !important; }
    </style>
</head>
<body>

    <header class="top-app-bar">
        <h1>Calculadora de Aportes</h1>
    </header>

    <main class="scaffold-body">
        
        <div class="md-field-group">
            <label class="md-label-static">Ingreso mensual</label>
            <div class="md-text-field">
                <input type="text" id="pago" placeholder="$ 0" inputmode="numeric">
            </div>
        </div>

        <div class="md-field-group">
            <label class="md-label-static">Método de liquidación</label>
            <div class="segmented-button">
                <div class="segment-item active" id="btn-manual" onclick="toggleMetodo('1')">Por Días</div>
                <div class="segment-item" id="btn-fecha" onclick="toggleMetodo('2')">Por Fechas</div>
            </div>
            <input type="hidden" id="metodoValue" value="1">
        </div>

        <div id="group-dias" class="md-field-group">
            <label class="md-label-static">Días trabajados</label>
            <div class="md-text-field">
                <input type="number" id="dias" placeholder="30" inputmode="numeric">
            </div>
        </div>

        <div id="group-fechas" class="hidden" style="display:flex; flex-direction:column; gap:16px;">
            <div class="md-field-group">
                <label class="md-label-static">Desde</label>
                <div class="md-text-field"><input type="date" id="fecha1"></div>
            </div>
            <div class="md-field-group">
                <label class="md-label-static">Hasta</label>
                <div class="md-text-field"><input type="date" id="fecha2"></div>
            </div>
        </div>

        <div class="md-card">
            <div class="card-row"><span class="row-label">Base IBC</span><span class="row-value" id="out-ibc">$ 0</span></div>
            <div class="card-row"><span class="row-label">Tiempo liquidado</span><span class="row-value" id="out-dias">0 días</span></div>
            <div class="card-row"><span class="row-label">Salud (12.5%)</span><span class="row-value" id="out-salud">$ 0</span></div>
            <div class="card-row"><span class="row-label">Pensión (16.0%)</span><span class="row-value" id="out-pension">$ 0</span></div>
            <div class="total-pill">
                <span style="font-weight:600;">Total Aportes</span>
                <span class="total-value" id="out-total">$ 0</span>
            </div>
        </div>

        <footer class="fluent-footer">
            Desarrollado por <strong>Jonathan Coral</strong><br>
            jonathancoral@unicomfacauca.edu.co
        </footer>
    </main>

    <script>
        const SMMLV = 1750905;
        const ui = {
            pago: document.getElementById('pago'),
            dias: document.getElementById('dias'),
            fecha1: document.getElementById('fecha1'),
            fecha2: document.getElementById('fecha2'),
            metodo: document.getElementById('metodoValue'),
            outIbc: document.getElementById('out-ibc'),
            outDias: document.getElementById('out-dias'),
            outSalud: document.getElementById('out-salud'),
            outPension: document.getElementById('out-pension'),
            outTotal: document.getElementById('out-total')
        };

        // Formateador de moneda
        const formatter = new Intl.NumberFormat('es-CO', {
            style: 'currency',
            currency: 'COP',
            maximumFractionDigits: 0
        });

        // Función para limpiar el formato y obtener solo el número
        function getRawValue(val) {
            return parseFloat(val.replace(/[^\d]/g, "")) || 0;
        }

        // Aplicar formato al escribir
        ui.pago.addEventListener('input', (e) => {
            let value = getRawValue(e.target.value);
            if (value === 0) e.target.value = "";
            else e.target.value = formatter.format(value);
            calcular();
        });

        function calcular() {
            const rawPago = getRawValue(ui.pago.value);
            const met = ui.metodo.value;
            let d = 0;

            if (met === '1') {
                d = parseInt(ui.dias.value) || 0;
            } else {
                if (ui.fecha1.value && ui.fecha2.value) {
                    const f1 = new Date(ui.fecha1.value + 'T00:00:00');
                    const f2 = new Date(ui.fecha2.value + 'T00:00:00');
                    if (!isNaN(f1) && !isNaN(f2) && f2 >= f1) d = Math.floor((f2 - f1) / 864e5) + 1;
                }
            }

            if (rawPago <= 0 || d <= 0) return resetUI();

            let ibc = Math.max(rawPago * 0.4, SMMLV);
            const sD = (ibc * 0.125) / 30, pD = (ibc * 0.16) / 30;
            const rnd = (v) => { let e = Math.floor(v); return (e % 100 !== 0) ? (Math.floor(e / 100) + 1) * 100 : e; };

            const tS = rnd(sD * d), tP = rnd(pD * d), total = rnd(tS + tP);

            ui.outIbc.textContent = formatter.format(ibc);
            ui.outDias.textContent = d + " días";
            ui.outSalud.textContent = formatter.format(tS);
            ui.outPension.textContent = formatter.format(tP);
            ui.outTotal.textContent = formatter.format(total);
        }

        function resetUI() { 
            ui.outTotal.textContent = "$ 0"; 
            ui.outIbc.textContent = "$ 0"; 
            ui.outDias.textContent = "0 días"; 
        }

        function toggleMetodo(v) {
            ui.metodo.value = v;
            document.getElementById('btn-manual').classList.toggle('active', v === '1');
            document.getElementById('btn-fecha').classList.toggle('active', v === '2');
            document.getElementById('group-dias').classList.toggle('hidden', v === '2');
            document.getElementById('group-fechas').classList.toggle('hidden', v === '1');
            calcular();
        }

        // Carga inicial por defecto solicitada
        window.addEventListener('DOMContentLoaded', () => {
            ui.pago.value = formatter.format(SMMLV);
            ui.dias.value = 30;
            calcular();
        });

        ['dias', 'fecha1', 'fecha2'].forEach(id => document.getElementById(id).oninput = calcular);
    </script>
</body>
</html>
